<------------------- AddCategory ------------------->
@model category
@{
    ViewData["Title"] = "addCategory";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<style>
    .cat{
        color: green;
    }
</style>

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <div class="card-header">
                <h3 class="text-center font-weight-light my-4">Add Category</h3>
            </div>
            <div class="card-body">
                <h4 class="cat">@ViewBag.cat</h4>
                <form method="post">
                    <div class="row mb-3">
                        <div class="col-md">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control" type="text" placeholder="Enter Category Name" asp-for="catName"/>
                                <label asp-for="catName">Category Name</label>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 mb-0">
                        <div class="d-grid"><button type="submit" class="btn btn-primary btn-block">Add Category</button></div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>



<------------------- Edit Category ------------------->
@model category
@{
    ViewData["Title"] = "editCategory";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<style>
    .cat {
        color: green;
    }
</style>



<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <div class="card-header">
                <h3 class="text-center font-weight-light my-4">Edit Category</h3>
            </div>
            <div class="card-body">
                <h4 class="cat">@ViewBag.cat</h4>
                <form method="post">
                    <input type="hidden" asp-for="catId" />
                    <div class="row mb-3">
                        <div class="col-md">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control" type="text" placeholder="Enter Category Name" asp-for="catName" />
                                <label asp-for="catName">Category Name</label>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 mb-0">
                        <div class="d-grid"><button type="submit" class="btn btn-primary btn-block">Edit Category</button></div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>



<------------------- View Category ------------------->
@model IEnumerable<category>
@{
    ViewData["Title"] = "allTables";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}


<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">Tables</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                <li class="breadcrumb-item active">Tables</li>
            </ol>
            <div class="card mb-4">
                <div class="card-body">
                    DataTables is a third party plugin that is used to generate the demo table below. For more information about DataTables, please visit the
                    <a target="_blank" href="https://datatables.net/">official DataTables documentation</a>
                    .
                </div>
            </div>
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    Category Table
                </div>
                <div class="card-body">
                    <table id="datatablesSimple">
                        <thead>
                            <tr>
                                <th>Category Id</th>
                                <th>Category Name</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>Category Id</th>
                                <th>Category Name</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                        </tfoot>
                        <tbody>
                            @foreach (var i in Model)
                            {
                                <tr>
                                    <td>@i.catId</td>
                                    <td>@i.catName</td>
                                    <td>
                                        <a asp-controller="Admin" asp-action="editCategory" asp-route-catid="@i.catId">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="blue" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z" />
                                            </svg>
                                        </a>
                                    </td>
                                    <td>
                                        <a asp-controller="Admin" asp-action="deleteCategory" asp-route-catid="@i.catId">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                                                <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5" />
                                            </svg>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>



<------------------- Add Product ------------------->
@model product
@{
    ViewData["Title"] = "addProduct";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<style>
    .prod {
        color: green;
    }
    .err {
        color: red;
    }
</style>

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <div class="card-header">
                <h3 class="text-center font-weight-light my-4">Add Product</h3>
            </div>
            <div class="card-body">
                <h4 class="prod">@ViewBag.prod</h4>
                <form method="post" enctype="multipart/form-data">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="text" placeholder="Enter Product Name" asp-for="prodName" />
                                <label asp-for="prodName">Product Name</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="number" placeholder="Enter Product Price" asp-for="prodPrice" />
                                <label asp-for="prodPrice">Product Price</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <textarea class="form-control mt-2" placeholder="Enter Product Description" asp-for="prodDesc"></textarea>
                                <label asp-for="prodDesc">Product Description</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="number" placeholder="Enter Product Quantity" asp-for="prodQty" />
                                <label asp-for="prodQty">Product Quantity</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <select asp-for="catId" asp-items="@ViewBag.cate" class="form-select mt-2">
                                    <option>Select a category</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="file" name="prodImg" />
                            </div>
                        </div>
                        <h6 class="err mt-2">@ViewBag.err</h6>
                    </div>
                    <div class="mt-4 mb-0">
                        <div class="d-grid"><button type="submit" class="btn btn-primary btn-block">Add Product</button></div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>



<------------------- Edit Product ------------------->
@model product
@{
    ViewData["Title"] = "editProduct";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
    .err{
         color: red;
    }
</style>


<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <div class="card-header">
                <h3 class="text-center font-weight-light my-4">Edit Product</h3>
            </div>
            <div class="card-body">
                <h4 class="prod">@ViewBag.prod</h4>
                <form method="post" enctype="multipart/form-data">
                    <div class="row mb-3">
                        <input type="hidden" asp-for="prodId"/>
                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="text" placeholder="Enter Product Name" asp-for="prodName" />
                                <label asp-for="prodName">Product Name</label>
                            </div>                          
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="number" placeholder="Enter Product Price" asp-for="prodPrice" />
                                <label asp-for="prodPrice">Product Price</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <textarea class="form-control mt-2" placeholder="Enter Product Description" asp-for="prodDesc"></textarea>
                                <label asp-for="prodDesc">Product Description</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="number" placeholder="Enter Product Quantity" asp-for="prodQty" />
                                <label asp-for="prodQty">Product Quantity</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <select asp-for="catId" asp-items="@ViewBag.cate" class="form-select mt-2">
                                    <option>Select a category</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <input class="form-control mt-2" type="file" name="prodImg" />
                            </div>
                        </div>
                        @* <div class="col-md-6">
                            <div class="form-floating mb-3 mb-md-0">
                                <img src="~/@Model.prodImg" class="rounded-circle mt-2" width="150" height="150" />
                            </div>
                        </div> *@

                        <h6 class="err mt-2">@ViewBag.err</h6>
                    </div>
                    <div class="mt-4 mb-0">
                        <div class="d-grid"><button type="submit" class="btn btn-primary btn-block">Edit Product</button></div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>



<------------------- View Product ------------------->
@model IEnumerable<product>
@{
    ViewData["Title"] = "viewProduct";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}


<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">Tables</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                <li class="breadcrumb-item active">Tables</li>
            </ol>
            <div class="card mb-4">
                <div class="card-body">
                    DataTables is a third party plugin that is used to generate the demo table below. For more information about DataTables, please visit the
                    <a target="_blank" href="https://datatables.net/">official DataTables documentation</a>
                    .
                </div>
            </div>
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    Product Table
                </div>
                <div class="card-body">
                    <table id="producttable">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Product Price</th>
                                <th>Product Description</th>
                                <th>Product Quantity</th>
                                <th>Category</th>
                                <th>Product Image</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>Product Name</th>
                                <th>Product Price</th>
                                <th>Product Description</th>
                                <th>Product Quantity</th>
                                <th>Category</th>
                                <th>Product Image</th>
                                <th>Edit</th>
                            </tr>
                        </tfoot>
                        <tbody>
                            @foreach (var i in Model)
                            {
                                <tr>
                                    <td>@i.prodName</td>
                                    <td>@i.prodPrice</td>
                                    <td>@i.prodDesc</td>
                                    <td>@i.prodQty</td>
                                    <td>@i.category.catName</td>
                                    <td><img src="~/@i.prodImg" width="50" height="50" class="rounded-circle" /></td>
                                    <td>
                                        <a asp-controller="Admin" asp-action="editProduct" asp-route-prodid="@i.prodId">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="blue" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z" />
                                            </svg>
                                        </a>
                                    </td>
                                    <td>
                                        <a asp-controller="Admin" asp-action="deleteProduct" asp-route-prodid="@i.prodId">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                                                <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5" />
                                            </svg>
                                        </a>
                                    </td>
                                    @* <td>
                                        <form method="post" asp-action="viewProduct" asp-route-id="@i.prodId">
                                            <button type="submit">Add to cart</button>
                                        </form>
                                    </td> *@
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>




<------------------- Admin Login ------------------->
@model adminLogin
@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Login - SB Admin</title>
    <link href="~/AdminAssets/css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
</head>
<body class="bg-dark">
    <div id="layoutAuthentication">
        <div id="layoutAuthentication_content">
            <main>
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-5">
                            <div class="card shadow-lg border-0 rounded-lg mt-5">
                                <div class="card-header"><h3 class="text-center font-weight-light my-4 text-uppercase" style="letter-spacing:4px">Admin Login</h3></div>
                                <div class="card-body">
                                    <form method="post">
                                        <div class="form-floating mb-3">
                                            <input class="form-control" type="email" placeholder="Email" asp-for="adminEmail" />
                                            <label asp-for="adminEmail">Email address</label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input class="form-control" type="password" placeholder="Password" asp-for="adminPass" />
                                            <label asp-for="adminPass">Password</label>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between mt-4 mb-0">
                                            <button class="btn btn-primary form-control" type="submit">Login</button>
                                        </div>
                                    </form>
                                </div>
                                <div class="card-footer text-center py-3">
                                    <div class="small"><h4 class="text-danger">@ViewBag.err</h4></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="~/AdminAssets/js/scripts.js"></script>
</body>
</html>






<------------------- Controller Work ------------------->
public IActionResult Index()
{
    if (HttpContext.Session.GetInt32("id") == null)
    {
        return RedirectToAction("adminLogin");
    }
    var list = db.categories.ToList();
    return View(list);
}

// Category Form
public IActionResult addCategory()
{
    return View();
}
// Category insert into database
[HttpPost]
public IActionResult addCategory(category category)
{
    db.categories.Add(category);
    db.SaveChanges();
    ViewBag.cat = "category inserted";
    return View();
}

public IActionResult editCategory(int? catid)
{
    var data = db.categories.Find(catid);
    return View(data);
}
[HttpPost]
public IActionResult editCategory(category category)
{
    db.categories.Update(category);
    db.SaveChanges();
    ViewBag.cat = "category updated";
    return View();
}

public IActionResult deleteCategory(int? catid)
{
    var data = db.categories.Find(catid);
    db.categories.Remove(data);
    db.SaveChanges();
    return RedirectToAction("allTables");
}
public IActionResult viewCategory()
{
    var list = db.categories.ToList();
    return View(list);
}




// Product Session
// Product Form
public IActionResult addProduct()
{
    var categories = db.categories.ToList();
    ViewBag.cate = new SelectList(categories, "catId", "catName");
    return View();
}
[HttpPost]
public IActionResult addProduct(product prod, IFormFile prodImg)
{
    var imgType = new[] { "png", "jpg", "jpeg" };
    if(prodImg != null && prodImg.Length > 0)
    {
        var fe = System.IO.Path.GetExtension(prodImg.FileName).Substring(1);

        if (!imgType.Contains(fe))
        {
            ViewBag.err = "Only png, jpg and jpeg allowed";
            var categories = db.categories.ToList();
            ViewBag.cate = new SelectList(categories, "catId", "catName");
            return View();
        }

        var rn = Path.GetFileName(prodImg.FileName);
        var fn = Guid.NewGuid() + rn;
        string fol = Path.Combine(HttpContext.Request.PathBase.Value, "wwwroot/productImgs");

        if (!Directory.Exists(fol))
        {
            Directory.CreateDirectory(fol);
        }
        string fp = Path.Combine(fol, fn);
        using (var s = new FileStream(fp, FileMode.Create))
        {
            prodImg.CopyTo(s);
        }
        var dba = Path.Combine("productImgs", fn);
        prod.prodImg = dba;
        db.products.Add(prod);
        db.SaveChanges();
        ViewBag.prod = "product inserted";
        RedirectToAction("Index");
    }
    return View();
}

public IActionResult editProduct(int? prodid)
{
    var data = db.products.Find(prodid);
    var categories = db.categories.ToList();
    ViewBag.cate = new SelectList(categories, "catId", "catName");
    return View(data);
}

[HttpPost]
public IActionResult editProduct(product prod, IFormFile prodImg)
{
    var imgType = new[] { "png", "jpg", "jpeg" };
    if (prodImg != null && prodImg.Length > 0)
    {
        var fe = System.IO.Path.GetExtension(prodImg.FileName).Substring(1);

        if (!imgType.Contains(fe))
        {
            ViewBag.err = "Only png, jpg and jpeg allowed";
            var categories = db.categories.ToList();
            ViewBag.cate = new SelectList(categories, "catId", "catName");
            return View();
        }

        var rn = Path.GetFileName(prodImg.FileName);
        var fn = Guid.NewGuid() + rn;
        string fol = Path.Combine(HttpContext.Request.PathBase.Value, "wwwroot/productImgs");

        if (!Directory.Exists(fol))
        {
            Directory.CreateDirectory(fol);
        }
        string fp = Path.Combine(fol, fn);
        using (var s = new FileStream(fp, FileMode.Create))
        {
            prodImg.CopyTo(s);
        }
        var dba = Path.Combine("productImgs", fn);
        prod.prodImg = dba;
        db.products.Update(prod);
        db.SaveChanges();
        return RedirectToAction("allTables");
    }
    return View();
}

public IActionResult deleteProduct(int? prodid)
{
    var data = db.products.Find(prodid);
    db.products.Remove(data);
    db.SaveChanges();
    return RedirectToAction("allTables");
}

public IActionResult viewProduct()
{
    var list = db.products.Include(cat => cat.category).ToList();
    return View(list);
}
//[HttpPost]
//public IActionResult viewProduct(int? id)
//{
//    if(HttpContext.Session.GetInt32("id") != null)
//    {
//        var adminId = Convert.ToInt32(HttpContext.Session.GetInt32("id"));
//        var prod = db.products.Find(id);
//        addtocart addtocart = new addtocart()
//        {
//            prodId = prod.prodId,
//            adminId = adminId,
//        };
//        db.addtocarts.Add(addtocart);
//        db.SaveChanges();
//        return RedirectToAction("Index");
//    }
//    else
//    {
//        return RedirectToAction("adminLogin");
//    }
//}



public IActionResult addCoupon()
{
    return View();
}
[HttpPost]
public IActionResult addCoupon(coupon code)
{
    db.coupons.Add(code);
    db.SaveChanges();
    ViewBag.coupon = "coupon inserted";
    return View();
}


public IActionResult adminLogin()
{
    if (HttpContext.Session.GetInt32("id") != null)
    {
        return RedirectToAction("Index");
    }
    return View();
}
[HttpPost]
public IActionResult adminLogin(adminLogin adminLogin)
{
    var admin = db.adminLogins.Where(db => db.adminEmail == adminLogin.adminEmail && db.adminPass == adminLogin.adminPass).FirstOrDefault();
    if(admin != null)
    {
        HttpContext.Session.SetInt32("id", admin.adminId);
        HttpContext.Session.SetString("name", admin.adminName);
        return RedirectToAction("Index");
    }
    else
    {
        ViewBag.err = "Login Failed";
    }
    return View();
}
public IActionResult Logout()
{
    HttpContext.Session.Clear();
    return RedirectToAction("adminLogin");
}